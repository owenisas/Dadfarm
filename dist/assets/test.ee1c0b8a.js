import{aU as L,a as u,aW as M,o as p,c as f,w as s,e as l,a5 as g,a9 as w,a4 as d,aK as C,a$ as j,aD as $,ae as G,af as K,ag as P,b0 as W,f as H,aL as _,_ as v,ac as k,x as y,s as U,aN as Y,a7 as x,a6 as z,a8 as J,aa as V,ab as O,aY as q,b1 as Q,t as X,a1 as Z,ad as ee}from"./index.90141216.js";import{C as ae}from"./cropper.esm.68fb77c3.js";const te=x("span",{class:"d-none d-sm-block"},"Reset",-1),ne={__name:"test",setup(le){const I=L(),b=u();u(!1),u();const c=u(!1);let h=u(0);const T=u("Submit"),t=u({title:"",currency:"HKD",price:"",description:"",tags:[],images:[]}),F=["USD","CNY","HKD","TWD"];function N(o){const a=o.target.value.replace(/\D+/g,"");t.value.price=a.slice(0,5)}const S=o=>{const a=Array.from(o.target.files||o.dataTransfer.files);!a.length||a.slice(0,8-t.value.images.length).forEach(e=>{D(e)})};function R(o,a){const e=o.split(","),n=e[0].match(/:(.*?);/)[1],r=atob(e[1]);let i=r.length;const m=new Uint8Array(i);for(;i--;)m[i]=r.charCodeAt(i);return new File([m],a,{type:n})}const E=async()=>{console.log(t.value.images);const o=new FormData;t.value.images.forEach((e,n)=>{o.append(`image${n}`,R(e,`image${n}.jpg`))});const a={...t.value};delete a.images,o.append("PostData",JSON.stringify(a));for(let e of o.entries())console.log(e[0]+", "+e[1]);try{c.value=!0;const e=await Z.post("/post/upload",o);if(e.status===200){const n=await e.data;console.log("Data submitted successfully:",n),alert("Submit Success!"),await I.push("/")}else c.value=!1,console.error("Error submitting data:",e.statusText)}catch(e){c.value=!1,console.error("Error submitting data:",e)}};function D(o){const a=new FileReader;a.onload=e=>{t.value.images.push(e.target.result),ee().then(()=>{const n=t.value.images.length-1,r=document.createElement("img");r.style.display="none",r.src=e.target.result,r.onload=()=>{document.body.appendChild(r);const i=new ae(r,{aspectRatio:1,viewMode:2,autoCropArea:1,center:!0,guides:!1,movable:!1,zoomable:!1,rotatable:!1,scalable:!1,ready:function(){const m=i.getCroppedCanvas();m?(t.value.images[n]=m.toDataURL("image/jpeg"),h.value++):console.warn("Failed to crop image:",r.src),i.destroy(),document.body.removeChild(r)}})}})},a.readAsDataURL(o)}const A=o=>{o.preventDefault();const a=Array.from(o.dataTransfer.files);a.length>0&&a.slice(0,8-t.value.images.length).forEach(e=>{e.type.startsWith("image/")?D(e):console.warn("The dropped file is not an image")})},B=()=>{t.value.images=[]};return M(()=>{window.location.reload()}),(o,a)=>(p(),f(g,{class:"floating-window"},{default:s(()=>[l(g,null,{default:s(()=>[l(w,null,{default:s(()=>[l(d,{cols:"12"},{default:s(()=>[C(l(g,null,{default:s(()=>[(p(),f(j,{key:$(h),"hide-delimiters":""},{default:s(()=>[(p(!0),G(K,null,P(t.value.images,(e,n)=>(p(),f(W,{key:n},{default:s(()=>[l(H,{src:e},null,8,["src"])]),_:2},1024))),128))]),_:1}))]),_:1},512),[[_,t.value.images&&t.value.images.length>0]]),t.value.images.length===0?(p(),f(v,{key:0,block:"",height:"500",class:"drag-and-drop-area",onDragover:a[0]||(a[0]=k(()=>{},["prevent"])),onClick:a[1]||(a[1]=e=>{var n;return(n=b.value)==null?void 0:n.click()}),onDrop:A},{default:s(()=>[l(y,{icon:"mdi-upload"}),U(" Upload/Drag and Drop "),l(y,{icon:"mdi-select-drag"})]),_:1})):Y("",!0),x("input",{ref_key:"uploadIMG",ref:b,type:"file",name:"file",accept:".jpeg,.png,.jpg",hidden:"",multiple:"",onInput:S},null,544),C(l(v,{type:"reset",color:"error",variant:"tonal",onClick:B},{default:s(()=>[te,l(y,{icon:"mdi-refresh",class:"d-sm-none"})]),_:1},512),[[_,t.value.images&&t.value.images.length>0]])]),_:1})]),_:1})]),_:1}),l(z,null,{default:s(()=>[l(J,{onSubmit:a[6]||(a[6]=k(()=>{},["prevent"]))},{default:s(()=>[l(w,{justify:"center"},{default:s(()=>[l(d,{cols:"5"},{default:s(()=>[l(V,{modelValue:t.value.title,"onUpdate:modelValue":a[2]||(a[2]=e=>t.value.title=e),label:"Title",maxlength:"30"},null,8,["modelValue"])]),_:1}),l(d,{cols:"4",md:"2"},{default:s(()=>[l(O,{modelValue:t.value.currency,"onUpdate:modelValue":a[3]||(a[3]=e=>t.value.currency=e),mandatory:"",items:F},null,8,["modelValue"])]),_:1}),l(d,{cols:"5"},{default:s(()=>[l(V,{modelValue:t.value.price,"onUpdate:modelValue":a[4]||(a[4]=e=>t.value.price=e),label:"Price",maxlength:"10",onInput:N},null,8,["modelValue"])]),_:1}),l(d,{cols:"12"},{default:s(()=>[l(V,{modelValue:t.value.description,"onUpdate:modelValue":a[5]||(a[5]=e=>t.value.description=e),label:"Description"},null,8,["modelValue"])]),_:1}),l(d,{cols:"12"},{default:s(()=>[l(q)]),_:1}),l(v,{width:"200",height:"50",block:c.value,loading:c.value,onClick:E},{loader:s(()=>[l(Q,{indeterminate:""})]),default:s(()=>[U(" "+X(T.value),1)]),_:1},8,["block","loading"])]),_:1})]),_:1})]),_:1})]),_:1}))}};export{ne as default};
